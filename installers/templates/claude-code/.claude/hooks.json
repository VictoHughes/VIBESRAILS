{
  "$schema": "https://raw.githubusercontent.com/anthropics/claude-code/main/schemas/hooks.json",
  "hooks": {
    "SessionStart": [
      {
        "type": "command",
        "command": "python3 -c \"import sys; from pathlib import Path; p=Path('vibesrails.yaml'); sys.exit(0 if p.exists() else 1)\" || echo '\ud83d\udca1 VibesRails: Run `vibesrails --setup` to configure security scanning'",
        "description": "Check if vibesrails is configured"
      },
      {
        "type": "command",
        "command": "python3 -c \"from pathlib import Path; plans=sorted(Path('docs/plans').glob('*.md'), key=lambda p: p.stat().st_mtime, reverse=True) if Path('docs/plans').exists() else []; print(f'\ud83d\udccb Active plan: {plans[0].name}') if plans else None\"",
        "description": "Show active plan from docs/plans/"
      },
      {
        "type": "command",
        "command": "python3 -c \"from pathlib import Path; p=Path('.claude/current-task.md'); print(f'\ud83d\udccc Current task: {p.read_text().strip()[:80]}...') if p.exists() and p.read_text().strip() else None\"",
        "description": "Show current task memo"
      },
      {
        "type": "command",
        "command": "rm -f .claude/.write_reminded 2>/dev/null; mkdir -p .claude; git rev-parse HEAD 2>/dev/null > .claude/.last_commit_hash || true",
        "description": "Reset session flags and store current commit hash"
      }
    ],
    "PreCompact": [
      {
        "type": "prompt",
        "prompt": "BEFORE COMPACTION: Auto-save current state. Write a summary to .claude/current-task.md with: 1) Active plan (docs/plans/*.md), 2) Current step, 3) Next actions, 4) TaskList with status. Format: short markdown.",
        "description": "Auto-save task state before compaction"
      }
    ],
    "PostToolUse": [
      {
        "type": "command",
        "matcher": "Write|Edit",
        "command": "python3 -c \"from pathlib import Path; d=Path('.claude'); d.mkdir(exist_ok=True); f=d/'.write_reminded'; showed=(print('\ud83d\udee1\ufe0f VibesRails: Code will be scanned on commit') or True) if not f.exists() and Path('vibesrails.yaml').exists() else False; f.touch() if showed else None\"",
        "description": "Remind about scanning (first Write only)"
      },
      {
        "type": "command",
        "matcher": "Bash",
        "command": "python3 -c \"from pathlib import Path; import subprocess; d=Path('.claude'); d.mkdir(exist_ok=True); f=d/'.last_commit_hash'; old=f.read_text().strip() if f.exists() else ''; new=subprocess.run(['git','rev-parse','HEAD'],capture_output=True,text=True).stdout.strip() if Path('.git').exists() else ''; changed=old and new and old!=new; f.write_text(new) if new else None; print('\u2705 New commit detected!') if changed else None\"",
        "description": "Detect new commits by comparing hashes"
      }
    ]
  }
}
