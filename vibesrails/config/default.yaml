# vibesrails - Scale up your vibe coding safely
# Single source of truth for security & quality patterns
#
# Usage:
#   python3 scripts/vibesrails.py --show     # voir patterns
#   python3 scripts/vibesrails.py --all      # scanner tout
#   python3 scripts/vibesrails.py            # scanner staged (pre-commit)

version: "1.0"

# KIONOS Safety Formula
kionos:
  formula: "C(q,xÌ‚) = Î±S + Î²V + Î³R"
  threshold: 0.7

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”’ SECURITY - Bloque le commit
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
blocking:
  - id: hardcoded_secret
    name: "Hardcoded Secret"
    regex: "(api_key|password|secret|token|pwd|passwd)\\s*=\\s*[\"'][^\"']{4,}"
    flags: "i"
    message: "Secret hardcodÃ© - utiliser variables d'environnement"

  - id: sql_injection
    name: "SQL Injection"
    regex: "\\.execute\\s*\\([^)]*f[\"']"
    message: "SQL injection - utiliser requÃªtes paramÃ©trÃ©es"

  - id: shell_injection
    name: "Shell Injection"
    regex: "shell\\s*=\\s*True"
    message: "shell=True dangereux - utiliser subprocess avec liste"

  - id: unsafe_yaml
    name: "Unsafe YAML"
    regex: "yaml\\.load\\s*\\("
    exclude_regex: "Loader\\s*="
    message: "Utiliser yaml.safe_load()"

  - id: unsafe_numpy
    name: "Unsafe NumPy"
    regex: "allow_pickle\\s*=\\s*True"
    message: "Permet exÃ©cution de code arbitraire"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âš ï¸ WARNINGS - SignalÃ© mais autorisÃ©
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
warning:
  - id: star_import
    name: "Star Import"
    regex: "from\\s+\\S+\\s+import\\s+\\*"
    message: "Ã‰viter star imports"
    skip_in_tests: true

  - id: none_comparison
    name: "None Comparison"
    regex: "==\\s*None"
    message: "Utiliser 'is None'"
    skip_in_tests: true

  - id: bare_except
    name: "Bare Except"
    regex: "except\\s*:"
    message: "Attraper exceptions spÃ©cifiques"
    skip_in_tests: true

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ› BUGS - Patterns causant des bugs silencieux
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
bugs:
  - id: mutable_default
    name: "Mutable Default (B006)"
    regex: "def \\w+\\([^)]*=\\s*\\[\\]|def \\w+\\([^)]*=\\s*\\{\\}"
    message: "Mutable default partagÃ© entre appels"
    level: "BLOCK"

  - id: assert_in_prod
    name: "Assert in Production"
    regex: "^\\s*assert\\s+(?!.*#.*test)"
    message: "assert ignorÃ© avec python -O"
    level: "WARN"
    skip_in_tests: true

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ—ï¸ ARCHITECTURE - RÃ¨gles projet
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
architecture:
  - id: dip_domain_infra
    name: "DIP Violation"
    regex: "from backend\\.infrastructure"
    scope: ["backend/domain/**/*.py"]
    message: "Domain ne doit pas importer Infrastructure"
    level: "BLOCK"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”§ MAINTENABILITÃ‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
maintainability:
  - id: print_debug
    name: "Print Debug"
    regex: "^\\s*print\\(.*debug|^\\s*print\\(f?[\"']\\s*(DEBUG|TODO|FIXME)"
    message: "Print oubliÃ© - utiliser logging"
    level: "WARN"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœ… EXCEPTIONS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
exceptions:
  test_files:
    patterns: ["test_*.py", "*_test.py", "**/tests/**/*.py"]
    allowed: ["hardcoded_secret", "shell_injection", "mutable_default"]
    reason: "Tests peuvent mocker patterns dangereux"

# Complexity (utilisÃ© par quality-gate.sh)
complexity:
  max_file_lines: 300
  max_function_lines: 50

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¤– GUARDIAN - AI Coding Safety
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
guardian:
  enabled: false           # Set to true to activate
  auto_detect: true        # Auto-detect AI coding sessions
  warnings_as_blocking: false  # Escalate warnings to blocking in AI mode
  # stricter_patterns: []  # Additional patterns for AI mode
