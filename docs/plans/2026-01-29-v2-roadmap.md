# VibesRails v2.0 — Complete Roadmap

> **Mission:** Transformer le vibe codeur Python en développeur senior — automatiquement.
> **Cible:** Solo + petite équipe (2-5 devs). Python-only.
> **Upgrade:** v1.3.0 → v2.0.0

---

## Architecture v2

```
vibesrails/
├── (existant v1 — inchangé)
├── guards/                    # NOUVEAU — tous les guards v2
│   ├── __init__.py
│   ├── dependency_audit.py    # Feature 1
│   ├── pr_checklist.py        # Feature 2
│   ├── performance.py         # Feature 3
│   ├── git_workflow.py        # Feature 4
│   ├── dead_code.py           # Feature 5
│   ├── env_safety.py          # Feature 6
│   ├── database_safety.py     # Feature 7
│   ├── api_design.py          # Feature 8
│   ├── observability.py       # Feature 9
│   ├── complexity.py          # Feature 10
│   ├── type_safety.py         # Feature 11
│   ├── docstring.py           # Feature 12
│   └── pre_deploy.py          # Feature 14
├── community/                 # NOUVEAU — community packs
│   ├── __init__.py
│   └── pack_manager.py        # Feature 13
├── advisors/                  # NOUVEAU — proactive advice
│   ├── __init__.py
│   └── upgrade_advisor.py     # Feature 15
installers-v2/                 # NOUVEAU — installeurs v2
├── unix/
│   ├── pip/install.sh
│   ├── source/install.sh
│   └── claude-code/install.sh
├── windows/
│   ├── pip/install.bat
│   ├── source/install.bat
│   └── claude-code/install.bat
├── cross-platform/
│   ├── pip/install.py
│   ├── source/install.py
│   └── claude-code/install.py
├── complete-package/
│   ├── INSTALL.sh
│   └── INSTALL.bat
└── README.md
```

---

## Features détaillées

### Feature 1: Dependency Audit (`--audit-deps`)
**Réflexe senior:** Vérifie les CVE et la supply chain avant d'installer.
**Module:** `vibesrails/guards/dependency_audit.py`

- Intègre `pip-audit` (ou appel API PyPI advisory)
- Scan `requirements.txt`, `pyproject.toml`, `setup.py`
- Détecte :
  - Packages avec CVE connues
  - Packages abandonnés (pas de release >2 ans)
  - Packages avec peu de maintainers (supply chain risk)
  - Typosquatting (noms proches de packages populaires)
- Output : tableau blocking/warning par dépendance
- CLI : `vibesrails --audit-deps`

### Feature 2: PR Checklist Guard (`--pr-check`)
**Réflexe senior:** Review systématique avant merge.
**Module:** `vibesrails/guards/pr_checklist.py`

- Génère une checklist automatique basée sur le diff :
  - [ ] Tests ajoutés/modifiés ?
  - [ ] Breaking changes documentés ?
  - [ ] Migration nécessaire ?
  - [ ] Variables d'env ajoutées ?
  - [ ] Documentation mise à jour ?
  - [ ] Security review nécessaire ?
- Détecte automatiquement ce qui s'applique (AST + patterns)
- Mode interactif : demande confirmation de chaque point
- CLI : `vibesrails --pr-check`

### Feature 3: Performance Guard
**Réflexe senior:** Détecte les anti-patterns de perf.
**Module:** `vibesrails/guards/performance.py`

Détecte (AST + regex) :
- Boucles N+1 (query dans une boucle for)
- `SELECT *` dans les requêtes SQL
- `.read()` sans limit sur fichiers
- Regex compilée dans une boucle
- List comprehension quand generator suffit (gros datasets)
- String concatenation en boucle (vs join)
- `time.sleep()` dans du code applicatif
- Nested loops O(n²) sur collections potentiellement grandes
- Global state mutation

### Feature 4: Git Workflow Guard
**Réflexe senior:** Branches, commits atomiques, conventions.
**Module:** `vibesrails/guards/git_workflow.py`

- Détecte push direct sur main/master
- Vérifie format des commit messages (conventional commits)
- Warn si branch name ne suit pas la convention (feature/, fix/, etc.)
- Détecte commits avec fichiers non-liés (>3 domaines différents)
- Détecte force push
- Mode solo : version allégée (juste commit messages + pas de push main)
- Mode équipe : version complète

### Feature 5: Dead Code Detector
**Réflexe senior:** Nettoie le code inutilisé.
**Module:** `vibesrails/guards/dead_code.py`

- Détecte (AST) :
  - Fonctions/classes jamais appelées (cross-file analysis)
  - Imports inutilisés
  - Variables assignées jamais utilisées
  - Code après return/raise/break
  - Branches if/else impossibles (constantes)
- Intègre avec `vulture` si disponible
- CLI : `vibesrails --dead-code`

### Feature 6: Env Safety Guard
**Réflexe senior:** Jamais de secrets en dur, .env géré proprement.
**Module:** `vibesrails/guards/env_safety.py`

- Vérifie :
  - `.env` dans `.gitignore`
  - `.env.example` existe (template pour l'équipe)
  - Pas de secrets hardcodés (renforce le scanner existant)
  - Variables d'env utilisées avec fallback safe
  - Pas de `os.environ["KEY"]` (crash si absent) → `os.environ.get("KEY")`
  - Fichiers `.pem`, `.key`, `.p12` pas dans le repo
- CLI : `vibesrails --env-check`

### Feature 7: Database Safety Guard
**Réflexe senior:** Migrations backward-compatible, queries safe.
**Module:** `vibesrails/guards/database_safety.py`

- Détecte :
  - Raw SQL sans paramètres (injection)
  - `DROP TABLE`, `TRUNCATE` dans le code
  - Migration sans rollback
  - `ALTER TABLE` qui casse la backward-compat (rename column, drop column)
  - Queries sans LIMIT sur des tables potentiellement grosses
  - Connexions DB sans pool/timeout
- Compatible : SQLAlchemy, Django ORM, raw SQL

### Feature 8: API Design Guard
**Réflexe senior:** REST conventions, versioning, erreurs propres.
**Module:** `vibesrails/guards/api_design.py`

- Détecte (FastAPI/Flask/Django) :
  - Endpoints sans validation d'input
  - Endpoints sans gestion d'erreurs HTTP
  - Incohérence de nommage (mix camelCase/snake_case)
  - Pas de versioning API (/v1/, /v2/)
  - Response sans schema/type défini
  - Endpoints sans rate limiting
  - CORS trop permissif (`*`)

### Feature 9: Observability Guard
**Réflexe senior:** Logging structuré, pas de print debug.
**Module:** `vibesrails/guards/observability.py`

- Détecte :
  - `print()` dans du code non-CLI (debug oublié)
  - Logging sans niveau (logger.info vs logger.debug)
  - `except` sans log de l'erreur
  - Pas de request ID / correlation ID
  - `traceback.print_exc()` au lieu de `logger.exception()`
- Suggère : structured logging (structlog pattern)

### Feature 10: Complexity Guard
**Réflexe senior:** Refactore quand c'est trop complexe.
**Module:** `vibesrails/guards/complexity.py`

- Mesure (AST) :
  - Cyclomatic complexity par fonction (warn >10, block >20)
  - Cognitive complexity (imbrication)
  - Nombre de paramètres (warn >5)
  - Profondeur d'imbrication (warn >4 niveaux)
  - Longueur de fonction (warn >50 lignes)
  - Nombre de return statements (warn >5)
- Output : score par fonction + suggestions de refactoring
- CLI : `vibesrails --complexity`

### Feature 11: Type Safety Guard
**Réflexe senior:** Type hints partout, mypy-ready.
**Module:** `vibesrails/guards/type_safety.py`

- Détecte :
  - Fonctions publiques sans type hints
  - Usage de `Any` explicite (warn)
  - `# type: ignore` sans justification
  - Return types incohérents (retourne str ou None sans Optional)
  - `isinstance()` excessif (suggère Union/Protocol)
- Intègre avec `mypy` si disponible

### Feature 12: Docstring Guard
**Réflexe senior:** API publique documentée.
**Module:** `vibesrails/guards/docstring.py`

- Détecte :
  - Classes publiques sans docstring
  - Fonctions publiques sans docstring
  - Docstrings outdated (mentions de params qui n'existent plus)
  - Modules sans docstring
- Respecte : ne force PAS les docstrings sur les fonctions privées (_)
- Format : Google style ou NumPy style (configurable)

### Feature 13: Community Packs
**Réflexe senior:** Partage et réutilise les bonnes pratiques.
**Module:** `vibesrails/community/pack_manager.py`

- Registry de packs communautaires (GitHub-based)
- Install : `vibesrails --install-pack @user/my-rules`
- Publish : `vibesrails --publish-pack`
- Packs officiels supplémentaires :
  - `@vibesrails/startup-pack` (move fast but safe)
  - `@vibesrails/data-science-pack`
  - `@vibesrails/ml-pack`
  - `@vibesrails/devops-pack`
- Validation des packs avant install

### Feature 14: Pre-deploy Checklist (`--pre-deploy`)
**Réflexe senior:** Checklist avant mise en prod.
**Module:** `vibesrails/guards/pre_deploy.py`

- Vérifie :
  - [ ] Tests passent (pytest exit 0)
  - [ ] Coverage au-dessus du seuil
  - [ ] Pas de TODO/FIXME bloquants
  - [ ] Pas de print() debug
  - [ ] .env.example à jour
  - [ ] Migrations appliquées
  - [ ] Dependencies auditées (CVE)
  - [ ] Version bumpée
  - [ ] CHANGELOG mis à jour
- Bloque le deploy si checklist incomplète

### Feature 15: Upgrade Advisor (`--upgrade`)
**Réflexe senior:** Met à jour régulièrement.
**Module:** `vibesrails/advisors/upgrade_advisor.py`

- Scan les dépendances pour :
  - Major versions disponibles
  - Security patches manquants
  - Dépendances deprecated
  - Compatibilité Python version
- Génère un plan d'upgrade priorisé
- CLI : `vibesrails --upgrade`

---

## Ordre d'implémentation

Par impact décroissant pour le vibe codeur :

| Ordre | Feature | Raison |
|-------|---------|--------|
| 1 | Dependency Audit | Faille #1 des vibe codeurs |
| 2 | Performance Guard | Bugs silencieux les plus coûteux |
| 3 | Complexity Guard | Base pour coder propre |
| 4 | Env Safety Guard | Secrets = catastrophe |
| 5 | Git Workflow Guard | Process #1 manquant |
| 6 | Dead Code Detector | Code propre = moins de bugs |
| 7 | Observability Guard | Debug sans print |
| 8 | Type Safety Guard | Bugs détectés avant runtime |
| 9 | Docstring Guard | Code maintenable |
| 10 | PR Checklist Guard | Process équipe |
| 11 | Database Safety | Critique si DB utilisée |
| 12 | API Design Guard | Critique si API |
| 13 | Pre-deploy Checklist | Synthèse de tout |
| 14 | Upgrade Advisor | Maintenance long terme |
| 15 | Community Packs | Écosystème |

---

## Version & Installeurs

- Bump `__init__.py` : `1.3.0` → `2.0.0`
- Bump `pyproject.toml` : version + nouvelles dépendances optionnelles
- Nouveau dossier `installers-v2/` (copie de `installers/` mise à jour)
- Dépendances optionnelles v2 : `pip-audit`, `vulture`, `mypy`

---

## Nouvelles commandes CLI v2

```bash
vibesrails --audit-deps      # Feature 1
vibesrails --pr-check        # Feature 2
vibesrails --dead-code       # Feature 5
vibesrails --env-check       # Feature 6
vibesrails --complexity      # Feature 10
vibesrails --pre-deploy      # Feature 14
vibesrails --upgrade         # Feature 15
vibesrails --install-pack    # Feature 13
vibesrails --senior-v2       # Tout : guards + review + audit
```
